## è®¤è¯†å‰ç«¯å·¥å…·é“¾ï¼ˆäºŒï¼‰

### å‰ç«¯å·¥å…·é“¾ç»¼è¿°

å·¥å…·é“¾åœ¨å‰ç«¯é¢†åŸŸæ‰®æ¼”ç€å¾ˆé‡è¦çš„è§’è‰²ã€‚å¦‚ä½•**ä¸ºJavascriptç”Ÿäº§ç¯å¢ƒæ„å»ºå»æ„å»ºä¸€å¥—å·¥å…·é“¾ï¼Œæ¥è¦†ç›–å‰ç«¯å„ä¸ªå¼€å‘ç¯èŠ‚**ï¼Œæ˜¯æˆ‘ä»¬éœ€è¦äº†è§£å­¦ä¹ çš„ã€‚è€Œä¸€å¥—é«˜æ•ˆçš„å·¥å…·é“¾ä½“ç³»ï¼Œå¯¹äºæ¯ä¸€ä¸ªå‰ç«¯å›¢é˜Ÿæ¥è¯´éƒ½æœ‰ç€è‡³å…³é‡è¦çš„æ„ä¹‰ï¼Œå®ƒä¸ä»…å¯ä»¥æé«˜å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ï¼Œè¿˜å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„èŒƒå‰ç«¯å¼€å‘çš„å„ä¸ªç¯èŠ‚ï¼Œè¿›è€Œä¸ºå›¢é˜ŸèŠ‚çœä¸€äº›äººå‘˜åä½œå’Œè°ƒæ•´çš„æˆæœ¬ã€‚

ç»¼ä¸Šï¼Œ**å‰ç«¯å·¥å…·é“¾æ—¨åœ¨å‹å¥½å¼€å‘ä½“éªŒï¼Œæå‡å¼€å‘å›¢é˜Ÿå¼€å‘æ•ˆç‡**ã€‚

è€Œè¦æ„å»ºä¸€ä¸ªå·¥å…·é“¾ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆè¦äº†è§£åœ¨å‰ç«¯å¼€å‘é¢†åŸŸæœ‰å“ªå‡ ä¸ªç¯èŠ‚ï¼š

* é¡¹ç›®åˆå§‹åŒ–
* å¼€å‘ã€è°ƒè¯•ã€æ„å»º
* å•å…ƒæµ‹è¯•
* å‘å¸ƒ

æ‰€ä»¥ä¸€ä¸ªå‰ç«¯å·¥å…·é“¾ï¼Œå®ƒå¤§è‡´éƒ½ä¼šåŒ…å«ä¸Šé¢è¿™ä¸€ç³»åˆ—åŠŸèƒ½ã€‚è€Œä¸€ä¸ªå…¸å‹çš„ç¤ºä¾‹å°±ç±»ä¼¼äºä¸‹é¢ï¼š

* Yeoman
* Webpack
* Mocha
* å‘å¸ƒç³»ç»Ÿ

æˆ‘ä»¬å¯ä»¥å°†è¿›è€Œå°†å®ƒæ€»ç»“æˆä¸‹é¢å‡ å—ï¼š

* è„šæ‰‹æ¶
* **æ„å»ºâ¼¯å…·**
* æµ‹è¯•å·¥å…·
* å‘å¸ƒç³»ç»Ÿ

è€Œä¸Šäº†è§„æ¨¡çš„å›¢é˜Ÿä¹Ÿéƒ½ä¼šé’ˆå¯¹ä»¥ä¸Šçš„æµç¨‹ï¼Œåˆ¶å®šä¸€ä¸ªå·¥å…·é“¾ï¼Œå¹¶å°†å®ƒåŒ…è£…æˆä¸€ä¸ªé»‘ç›’å½¢å¼ï¼Œè®©ç¨‹åºå‘˜åœ¨æ¯ä¸ªç¯èŠ‚åªéœ€è¦è¿è¡Œç®€å•å‘½ä»¤è¡Œï¼Œå³å¯è¿›å…¥å¼€å‘æµç¨‹ã€‚

è€Œä»æ•´ä½“ä¸Šäº†è§£å·¥å…·é“¾ç›¸å…³çš„çŸ¥è¯†ä½“ç³»ï¼Œç†Ÿæ‚‰å…¶å¤§è‡´ç»“æ„ä»¥åŠè¿ä½œæ–¹å¼ï¼Œä¹Ÿæ˜¯ååˆ†é‡è¦çš„ã€‚

æ‰€ä»¥ï¼Œä¸‹é¢è¿™é‡Œæ˜¯æœ¬äººå°†å¯¹äºå·¥å…·é“¾ç›¸å…³åŸºç¡€çŸ¥è¯†çš„ä¸€äº›æ•´ç†ã€‚è¿™ä¸€ç¯‡æˆ‘ä»¬é¦–å…ˆæ¥ä»‹ç»çš„æ˜¯ï¼Œå·¥å…·é“¾ä¸­çš„**æ„å»ºå·¥å…·**ã€‚

### æ„å»ºå·¥å…·

å¯¹äºä¸€ä¸ªå·¥å…·é“¾æ¥è¯´ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„åˆå§‹åŒ–æ“ä½œï¼Œæ¥ä¸‹äº†æœ€é‡è¦çš„å·¥ä½œå°±æ˜¯buildå®ƒã€‚buildçš„èƒ½åŠ›æ˜¯ä¸€ç§ç‹¬ç«‹çš„èƒ½åŠ›ï¼Œå®ƒæ˜¯åŒæ—¶ä¸ºå¼€å‘ä»¥åŠå‘å¸ƒæœåŠ¡åŸºç¡€è®¾æ–½ã€‚

åŒæ—¶ç”±äºæˆ‘ä»¬æµè§ˆå™¨åœ¨æŸäº›æ–¹é¢æ˜¯å¤©ç„¶å‹å¥½ï¼ŒåŒæ—¶è€ƒè™‘åˆ°æ–¹ä¾¿å¼€å‘ã€æ€§èƒ½ä¼˜åŒ–ï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³åƒï¼š```è½¬æ¢ES6è¯­æ³•```ã€```JSXè½¬æ¢```ã€```CSS å‰ç¼€è¡¥å…¨/é¢„å¤„ç†å™¨```ã€```å‹ç¼©æ··æ·†```ã€```å›¾â½šå‹ç¼©```ç­‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ„å»ºâ¼¯å…·ã€‚

è¿™é‡Œæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»çš„ä½¿æˆ‘ä»¬çš„**webpack**ä»¥åŠæˆ‘ä»¬å¸¸ç”¨åˆ°çš„**babel**ã€‚

é¦–å…ˆå„ç§æ„å»ºå·¥å…·çš„å¯¹æ¯”ï¼š

| åç§°         | webpack        | grunt       | gulp        |
| ------------ | -------------- | ----------- | ----------- |
| å®šä¹‰         | Module bundler | Task runner | Task runner |
| è¯­è¨€         | JavaScript     | Node.js     | Node.js     |
| å‘å¸ƒæ—¶é—´     | 2012.3         | 2012.6      | 2013.7      |
| GitHub stars | 58.3k          | 12.1k       | 32.2k       |
| å‘¨ä¸‹è½½é‡     | 13,373,858     | 670,553     | 1,215,605   |

##### ä¸ºä»€ä¹ˆé€‰æ‹©webpackï¼Ÿ

æ„å»ºå·¥å…·æ˜¯æŒ‰ç…§å®ƒä»¬è¯ç”Ÿçš„æ—¶é—´æ’åºçš„ï¼Œå®ƒä»¬æ˜¯æ—¶ä»£çš„äº§ç‰©ï¼Œä¾§é¢åæ˜ å‡ºWebå¼€å‘çš„å‘å±•è¶‹åŠ¿ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š

* åœ¨Gruntæ—¶ä»£ï¼ŒWebå¼€å‘è¦åšçš„äº‹æƒ…å˜å¤šï¼Œæµç¨‹å¤æ‚ï¼Œè‡ªåŠ¨åŒ–æ€æƒ³è¢«å¼•å…¥ï¼Œç”¨äºç®€åŒ–æµç¨‹ï¼›

* åœ¨Gulpæ—¶ä»£ï¼Œå¼€å§‹å‡ºç°ä¸€äº›æ–°è¯­è¨€ç”¨äºæé«˜å¼€å‘æ•ˆç‡ï¼Œæµå¼å¤„ç†æ€æƒ³çš„å‡ºç°æ˜¯ä¸ºäº†ç®€åŒ–æ–‡ä»¶è½¬æ¢çš„æµç¨‹ï¼Œä¾‹å¦‚å°†ES5è½¬æ¢æˆES6ï¼›

* åœ¨Webpackæ—¶ä»£ï¼Œç”±äºå•é¡µåº”ç”¨çš„æµè¡Œï¼Œç½‘é¡µçš„åŠŸèƒ½å’Œå®ç°ä»£ç å˜å¾—å¤æ‚ã€åºå¤§ï¼ŒWebå¼€å‘å‘æ¨¡å—åŒ–æ”¹è¿›ã€‚

è¿™äº›æ„å»ºå·¥å…·éƒ½æœ‰å„è‡ªçš„å®šä½å’Œä¸“æ³¨ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´æ—¢å¯ä»¥å•ç‹¬å®Œæˆä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥ç›¸äº’æ­é…æ¥å¼¥è¡¥å„è‡ªçš„ä¸è¶³ã€‚åœ¨äº†è§£è¿™äº›å¸¸è§çš„æ„å»ºå·¥å…·åï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚å»åˆ¤æ–­åº”è¯¥å¦‚ä½•é€‰æ‹©å’Œæ­é…å®ƒä»¬æ‰èƒ½æ›´å¥½åœ°æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚

ç»è¿‡å¤šå¹´çš„å‘å±•ï¼ŒWebpackå·²ç»æˆä¸ºæ„å»ºå·¥å…·ä¸­çš„é¦–é€‰ï¼Œè¿™æ˜¯æœ‰åŸå› çš„ï¼š

* **é…ç½®çµæ´»å’Œæ’ä»¶åŒ–æ‰©å±•ï¼š**å¤§å¤šæ•°å›¢é˜Ÿåœ¨å¼€å‘æ–°é¡¹ç›®æ—¶ä¼šé‡‡ç”¨ç´§è·Ÿæ—¶ä»£çš„æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯å‡ ä¹éƒ½ä¼šé‡‡ç”¨â€œæ¨¡å—åŒ–+æ–°è¯­è¨€+æ–°æ¡†æ¶â€ï¼ŒWebpackå¯ä»¥ä¸ºè¿™äº›æ–°é¡¹ç›®æä¾›ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆï¼›

* **å®˜â½…æ›´æ–°è¿­ä»£é€Ÿåº¦å¿«**ï¼šWebpackæœ‰è‰¯å¥½çš„ç”Ÿæ€é“¾å’Œç»´æŠ¤å›¢é˜Ÿï¼Œèƒ½æä¾›è‰¯å¥½çš„å¼€å‘ä½“éªŒå¹¶ä¿è¯è´¨é‡ï¼›

* **ç¤¾åŒºâ½£æ€ä¸°å¯Œï¼š**Webpackè¢«å…¨ä¸–ç•Œå¤§é‡çš„Webå¼€å‘è€…ä½¿ç”¨å’ŒéªŒè¯ï¼Œèƒ½æ‰¾åˆ°å„ä¸ªå±‚é¢æ‰€éœ€çš„æ•™ç¨‹å’Œç»éªŒåˆ†äº«ã€‚

#### webpack

Webpackæ˜¯ä¸€ç§å¸¸è§çš„buildå·¥å…·ï¼Œå®ƒæœ€åˆæ˜¯ä¸º**Node**è®¾è®¡çš„ä¸€æ¬¾æ‰“åŒ…å·¥å…·ï¼Œå®ƒå¯å°†ä¸€ä¸ª**Node**çš„ä»£ç æ‰“åŒ…æˆä¸€ä¸ªæµè§ˆå™¨å¯ç”¨çš„ä»£ç ï¼Œæ‰€ä»¥å®ƒä»æœ€åˆçš„è®¾è®¡ä¸Šæ˜¯ä¸€ä¸ªå®Œå…¨é’ˆå¯¹äºJSçš„è¿™æ ·çš„ä¸€ä¸ªç³»ç»Ÿï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°htmlçš„éƒ¨åˆ†ï¼Œä»¥è‡³äºç°åœ¨æœ‰è®¸å¤šçš„åèµ·ä¹‹ç§€çš„æ‰“åŒ…å·¥å…·æ˜¯åŸºäºhtmlå»æ‰“åŒ…çš„ï¼Œç›¸æ¯”ä¹‹ä¸‹å¯¹äºé…ç½®çš„è¦æ±‚å°±è¦ä½å¾—å¤šã€‚

Webpackçš„æ ¸å¿ƒæ€è·¯å°±æ˜¯å°†æ‰€æœ‰ç›¸å…³çš„ä»£ç ï¼Œç»è¿‡ä¸€ç³»åˆ—buildæ“ä½œä¹‹åï¼Œæ‰“åŒ…æˆä¸€ä¸ªjsæ–‡ä»¶ï¼Œå¹¶éœ€è¦æˆ‘ä»¬æ‰‹å·¥çš„å¼•ç”¨jsæ–‡ä»¶åˆ°htmlã€‚

Webpackå¯ä»¥å¸®åŠ©æˆ‘ä»¬åšå¤šæ–‡ä»¶åˆå¹¶ï¼Œåœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­å®ƒå¯ä»¥é€šè¿‡å„ç§å„æ ·çš„**loaderå’Œplugin**å»æ§åˆ¶åˆå¹¶çš„ä¸€äº›è§„åˆ™ï¼Œå¹¶è¿›è€Œå¯¹æ–‡æœ¬è¿›è¡Œä¸€äº›è½¬æ¢ã€‚

![webpack](./img/webapck.jpg)



#### webapckçš„æ ¸å¿ƒæ¦‚å¿µ

##### Entry

Entryæ˜¯wepackä»å“ªä¸ªæ–‡ä»¶å¼€å§‹è¿›è¡Œæ„å»ºæ‰“åŒ…ã€‚

```js
// å•å…¥å£entryæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
moudule.exports = {
  entry: './src/index.js'
}
// å¤šå…¥å£entryæ˜¯ä¸€ä¸ªå¯¹è±¡
moudule.exports = {
  entry: {
    app: './src/app.js'
    home: './src/home.js'
  }
}
```

##### Output

Output â½¤æ¥å‘Šè¯‰ webpack å¦‚ä½•å°†ç¼–è¯‘åçš„â½‚ä»¶è¾“å‡ºåˆ°ç£ç›˜ã€‚

```js
// Output çš„â½¤æ³•ï¼šå•â¼Šâ¼é…ç½®
module.exports = {
  entry: './src/index.js'
  output: {
  filename: 'bundle.jsâ€™,
  path: __dirname + '/dist'
  }
};
// Output çš„â½¤æ³•ï¼šå¤šâ¼Šâ¼é…ç½®
module.exports = {
  entry: {
    app: './src/app.js',
    home: './src/home.js'
  },
  output: {
    filename: '[name].js',// é€šè¿‡å ä½ç¬¦ç¡®ä¿â½‚ä»¶åç§°çš„å”¯â¼€
    path: __dirname + '/dist'
  }
};
```

##### Loaders

**webpack** å¼€ç®±å³ç”¨åªæ”¯æŒ JS å’Œ JSON ä¸¤ç§æ–‡ä»¶ç±»å‹ï¼Œé€šè¿‡ **Loaders** å»æ”¯æŒå…¶å®ƒæ–‡ä»¶ç±»å‹å¹¶ä¸”æŠŠå®ƒä»¬è½¬åŒ–æˆæœ‰æ•ˆçš„æ¨¡å—ï¼Œå¹¶ä¸”å¯ä»¥æ·»åŠ åˆ°ä¾èµ–å›¾ä¸­ã€‚**Loaders**æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—æºæ–‡ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›è½¬æ¢çš„ç»“æœã€‚

Loaders çš„â½¤æ³•:

```js
const path = require('path');
module.exports = {
  output: {
    filename: 'bundle.js'
  },
	module: {
    rules: [
        { test: /\.txt$/, use: 'raw-loader' }// test æŒ‡å®šåŒ¹é…è§„åˆ™, use æŒ‡å®šä½¿â½¤çš„ loader åç§° 
    ]
  }
};
```

å¸¸ç”¨Loadersï¼š

| åç§°          | æè¿°                                                       |
| ------------- | ---------------------------------------------------------- |
| babel-loader  | è½¬æ¢ES6ã€ES7ç­‰JSæ–°ç‰¹æ€§è¯­æ³•                                 |
| css-loader    | æ”¯æŒ.cssæ–‡ä»¶åŠ è½½å’Œè§£æ                                     |
| ts-loader     | å°†TSè½¬æ¢æˆJS                                               |
| file-loader   | è¿›è¡Œå›¾ç‰‡ã€å­—ä½“ç­‰çš„æ‰“åŒ…                                     |
| thread-loader | å¤šè¿›ç¨‹æ‰“åŒ…JSå’ŒCSS                                          |
| html-loader   | å°† HTML å¯¼å‡ºä¸ºå­—ç¬¦ä¸²ã€‚å½“ç¼–è¯‘å™¨éœ€è¦æ—¶ï¼Œå°†å‹ç¼© HTML å­—ç¬¦ä¸²ã€‚ |
| less-loader   | webpack å°† Less ç¼–è¯‘ä¸º CSS çš„ loader                       |

å…·ä½“å¯å‚è§ï¼š[loaders](https://webpack.docschina.org/loaders/)

##### Plugins

æ’ä»¶â½¤äº **bundle** â½‚ä»¶çš„ä¼˜åŒ–ï¼Œèµ„æºç®¡ç†å’Œç¯å¢ƒå˜é‡æ³¨â¼Šï¼Œä½œâ½¤äºæ•´ä¸ªæ„å»ºè¿‡ç¨‹ã€‚

```js
const path = require('path');
module.exports = {
  output: {
  	filename: 'bundle.js'	
  },
  plugins: [
    new HtmlWebpackPlugin({template: 
      './src/index.html'})
  ]
};
```

å¸¸ç”¨Pluginsï¼š

| åç§°                       | æè¿°                                                         |
| -------------------------- | ------------------------------------------------------------ |
| CommonsChunkPlugin         | CommonsChunkPluginæ˜¯ä¸€é¡¹é€‰æ‹©åŠ å…¥åŠŸèƒ½ï¼Œå¯åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼ˆç§°ä¸ºå—ï¼‰ï¼Œè¯¥æ–‡ä»¶ç”±å¤šä¸ªå…¥å£ç‚¹ä¹‹é—´å…±äº«çš„é€šç”¨æ¨¡å—ç»„æˆã€‚ |
| UglifyjsWebpackPlugin      | æ­¤æ’ä»¶ä½¿ç”¨ [uglify-js](https://github.com/mishoo/UglifyJS2) å‹ç¼©ä½ çš„ JavaScriptã€‚ |
| ExtractTextWebpackPlugin   | ä»ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ä¸­æå–æ–‡æœ¬åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚                 |
| HtmlWebpackPlugin          | åˆ›å»ºhtmlæ–‡ä»¶å»æ‰¿è½½è¾“å‡ºçš„bundle                               |
| HotModuleReplacementPlugin | å¯ç”¨çƒ­æ¨¡å—æ›´æ¢ï¼ˆHMRï¼‰                                        |
| CopyWebpackPlugin          | å°†å•ä¸ªæ–‡ä»¶æˆ–æ•´ä¸ªç›®å½•ï¼ˆå·²å­˜åœ¨ï¼‰å¤åˆ¶åˆ°æ„å»ºç›®å½•ã€‚               |
| EslintWebpackPlugin        | ç”¨äºWebpackçš„ESLintæ’ä»¶                                      |

å…·ä½“å¯å‚è§ï¼š[Plugins](https://webpack.docschina.org/plugins/)

##### Mode

**Mode** â½¤æ¥æŒ‡å®šå½“å‰çš„æ„å»ºç¯å¢ƒæ˜¯ï¼š**production**ã€**development** è¿˜æ˜¯ **none**ï¼›è®¾ç½® **mode** å¯ä»¥ä½¿â½¤ **webpack** å†…ç½®çš„å‡½æ•°ï¼Œé»˜è®¤å€¼ä¸º **production**ã€‚

| é€‰é¡¹          | æè¿°                                                         |
| :------------ | :----------------------------------------------------------- |
| `development` | ä¼šå°† `DefinePlugin` ä¸­ `process.env.NODE_ENV` çš„å€¼è®¾ç½®ä¸º `development`. ä¸ºæ¨¡å—å’Œ chunk å¯ç”¨æœ‰æ•ˆçš„åã€‚ |
| `production`  | ä¼šå°† `DefinePlugin` ä¸­ `process.env.NODE_ENV` çš„å€¼è®¾ç½®ä¸º `production`ã€‚ä¸ºæ¨¡å—å’Œ chunk å¯ç”¨ç¡®å®šæ€§çš„æ··æ·†åç§°ï¼Œ`FlagDependencyUsagePlugin`ï¼Œ`FlagIncludedChunksPlugin`ï¼Œ`ModuleConcatenationPlugin`ï¼Œ`NoEmitOnErrorsPlugin` å’Œ `TerserPlugin` ã€‚ |
| `none`        | ä¸ä½¿ç”¨ä»»ä½•é»˜è®¤ä¼˜åŒ–é€‰é¡¹                                       |

å…·ä½“å¯å‚è§ï¼š[Mode](https://webpack.docschina.org/configuration/mode/)

#### é«˜é¢‘é¢è¯•é¢˜

[**æ¨¡å—çƒ­æ›¿æ¢(hot module replacement)**](https://webpack.docschina.org/concepts/hot-module-replacement/)

æ¨¡å—çƒ­æ›¿æ¢(HMR - hot module replacement)åŠŸèƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤ [æ¨¡å—](https://webpack.docschina.org/concepts/modules/)ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚ä¸»è¦æ˜¯é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æ˜¾è‘—åŠ å¿«å¼€å‘é€Ÿåº¦ï¼š

- ä¿ç•™åœ¨å®Œå…¨é‡æ–°åŠ è½½é¡µé¢æœŸé—´ä¸¢å¤±çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚
- åªæ›´æ–°å˜æ›´å†…å®¹ï¼Œä»¥èŠ‚çœå®è´µçš„å¼€å‘æ—¶é—´ã€‚
- åœ¨æºä»£ç ä¸­ CSS/JS äº§ç”Ÿä¿®æ”¹æ—¶ï¼Œä¼šç«‹åˆ»åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæ›´æ–°ï¼Œè¿™å‡ ä¹ç›¸å½“äºåœ¨æµè§ˆå™¨ devtools ç›´æ¥æ›´æ”¹æ ·å¼ã€‚

çƒ­æ›´æ–°åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š

![çƒ­æ›´æ–°](./img/çƒ­æ›´æ–°.jpg)

- ç¬¬ä¸€ä¸ªè¿‡ç¨‹æ˜¯å¯åŠ¨é˜¶æ®µï¼š

- - æ–‡ä»¶ç³»ç»Ÿå¯¹æ–‡ä»¶è¿›è¡Œä¸€ä¸ªç¼–è¯‘ï¼Œå°†åˆå§‹çš„ä»£ç éƒ½ç»è¿‡webpack Complieè¿›è¡Œä¸€ä¸ªæ‰“åŒ…ï¼Œæ‰“åŒ…å¥½äº†ä¹‹åï¼Œå°†ç¼–è¯‘å¥½çš„è¿™ä¸ªæ–‡ä»¶ä¼ è¾“ç»™Bundle Serverã€‚Bundle Serveræ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼ŒBundle Server ä»¥serverçš„æ–¹å¼è®©æµè§ˆå™¨å¯ä»¥è®¿é—®åˆ°æ‰“åŒ…å¥½çš„Bundle.jsæ–‡ä»¶ï¼Œ
  - è¿™ä¸ªæ˜¯ä¸€ä¸ªå¯åŠ¨çš„é˜¶æ®µï¼Œå¯¹ç…§å›¾ä¸­çš„1->2->A->Bã€‚

- ç¬¬äºŒä¸ªè¿‡ç¨‹æ˜¯æ–‡ä»¶æ›´æ–°é˜¶æ®µï¼š

- - åœ¨æœ¬åœ°å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ã€‚åŒæ ·ï¼Œå˜åŒ–çš„æ–‡ä»¶ä¼šç»è¿‡æ–‡ä»¶ç³»ç»Ÿçš„ç¼–è¯‘ï¼Œwebpack Complieè¿›è¡Œä¸€ä¸ªæ‰“åŒ…ã€‚
  - ç„¶åï¼Œä»–ä¼šå°†ç¼–è¯‘ä¹‹åçš„ä»£ç å‘é€ç»™HMR Serverï¼ŒHMR Serverå°±å¯ä»¥çŸ¥é“å“ªäº›èµ„æºã€æ¨¡å—å‘ç”Ÿäº†æ”¹å˜ã€‚å³æºä»£ç jsé‡Œé¢å“ªäº›æ¨¡å—å‘ç”Ÿäº†æ”¹å˜ã€‚
  - ç„¶åï¼ŒHMR Serverï¼ˆæœåŠ¡ç«¯ï¼‰ä¼šé€šè¿‡web socketçš„å½¢å¼é€šçŸ¥HMR Runtimeï¼ˆå®¢æˆ·ç«¯æµè§ˆå™¨ï¼‰é‚£äº›æ–‡ä»¶ä»£ç å‘ç”Ÿäº†å˜åŒ–ï¼Œé€šå¸¸ä»¥JSONçš„æ ‘è¿›è¡Œä¼ è¾“ï¼ŒHMR Runtimeæ¥æ”¶åˆ°äº†ä¹‹åå°±ä¼šè¿›è€Œå»æ›´æ–°æˆ‘ä»¬çš„ä»£ç ï¼Œæœ€åè¿›è¿‡ä¸€ç³»åˆ—çš„è‡ªåŠ¨æ“ä½œè‡ªåŠ¨æ›´æ–°åˆ°æµè§ˆå™¨é¡µé¢ä¸Šã€‚
  - è¿™ä¸ªæ˜¯ä¸€ä¸ªæ›´æ–°çš„é˜¶æ®µï¼Œå¯¹ç…§å›¾ä¸­çš„1->2->3->4ã€‚

#### babel

Babelæ˜¯ä¸€ä¸ªJSçš„è½¬ä¹‰å™¨ï¼Œç”¨äº es nextã€typescriptç­‰ä»£ç çš„è½¬æ¢ï¼ŒåŒæ—¶è¿˜æš´éœ²å‡ºäº† api è®©å¼€å‘è€…å¯ä»¥è¿›è¡Œç‰¹å®šç”¨é€”çš„è½¬æ¢ï¼Œå¦å¤–è¿˜å¯ç”¨äºåšå„ç§é™æ€åˆ†æã€‚

##### å®‰è£…ä½¿ç”¨

è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€çš„åŒ…ï¼ˆpackageï¼‰ï¼š

```shell
npm install --save-dev @babel/core @babel/cli @babel/preset-env
npm install --save @babel/polyfill
```

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå‘½åä¸º `babel.config.json` çš„é…ç½®æ–‡ä»¶ï¼ˆéœ€è¦ `v7.8.0` æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ­¤æ–‡ä»¶ä¸­ï¼š

```json
{
  "presets": [
    [
      "@babel/env",
      {
        "targets": {
          "edge": "17",
          "firefox": "60",
          "chrome": "67",
          "safari": "11.1",
        },
        "useBuiltIns": "usage",
        "corejs": "3.6.5",
      }
    ]
  ]
}
```

* @babel/preset-env : babelé…ç½®ç¹çï¼Œè¿™é‡Œå­˜å‚¨äº†ä¸€äº›å¸¸ç”¨çš„babelé…ç½®

è¿è¡Œæ­¤å‘½ä»¤å°† `src` ç›®å½•ä¸‹çš„æ‰€æœ‰ä»£ç ç¼–è¯‘åˆ° `lib` ç›®å½•ï¼š

```shell
./node_modules/.bin/babel src --out-dir lib
```

è¿™å°±æ˜¯babelç‹¬ç«‹ä½¿ç”¨çš„ä¸€äº›æ“ä½œï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å¹¶ä¸ä¼šç‹¬ç«‹ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯ä½¿ç”¨```babel-loader```,å°†babelå·¥å…·ç”¨äºWebpackæ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸ªæ–‡ä»¶éƒ½æ‰§è¡Œbabelæ“ä½œã€‚

äº†è§£äº†babelçš„ç®€å•ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥å°±è¦è®²åˆ°babelçš„å·¥ä½œåŸç†äº†ã€‚

åœ¨ä»‹ç»babelçš„å·¥ä½œåŸç†ä¹‹å‰æˆ‘ä»¬å…ˆè¦äº†è§£ä¸€ä¸ªæ¦‚å¿µï¼š**AST**ï¼Œ å³**æŠ½è±¡è¯­æ³•æ ‘**ï¼ˆ**A**bstract **S**yntax **T**reeï¼ŒASTï¼‰ã€‚

**ä»€ä¹ˆæ˜¯ASTï¼Ÿ**

åœ¨[è®¡ç®—æœºç§‘å­¦](https://zh.wikipedia.org/wiki/è®¡ç®—æœºç§‘å­¦)ä¸­ï¼Œ**æŠ½è±¡è¯­æ³•æ ‘**ï¼ˆ**A**bstract **S**yntax **T**reeï¼ŒASTï¼‰ï¼Œæˆ–ç®€ç§°**è¯­æ³•æ ‘**ï¼ˆSyntax treeï¼‰ï¼Œæ˜¯[æºä»£ç ](https://zh.wikipedia.org/wiki/æºä»£ç )[è¯­æ³•](https://zh.wikipedia.org/wiki/è¯­æ³•å­¦)ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥[æ ‘çŠ¶](https://zh.wikipedia.org/wiki/æ ‘_(å›¾è®º))çš„å½¢å¼è¡¨ç°[ç¼–ç¨‹è¯­è¨€](https://zh.wikipedia.org/wiki/ç¼–ç¨‹è¯­è¨€)çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚ä¹‹æ‰€ä»¥è¯´è¯­æ³•æ˜¯â€œæŠ½è±¡â€çš„ï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„è¯­æ³•å¹¶ä¸ä¼šè¡¨ç¤ºå‡ºçœŸå®è¯­æ³•ä¸­å‡ºç°çš„æ¯ä¸ªç»†èŠ‚ã€‚æ¯”å¦‚ï¼ŒåµŒå¥—æ‹¬å·è¢«éšå«åœ¨æ ‘çš„ç»“æ„ä¸­ï¼Œå¹¶æ²¡æœ‰ä»¥èŠ‚ç‚¹çš„å½¢å¼å‘ˆç°ï¼›è€Œç±»ä¼¼äº `if-condition-then` è¿™æ ·çš„æ¡ä»¶è·³è½¬è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸‰ä¸ªåˆ†æ”¯çš„èŠ‚ç‚¹æ¥è¡¨ç¤ºã€‚

å’ŒæŠ½è±¡è¯­æ³•æ ‘ç›¸å¯¹çš„æ˜¯å…·ä½“è¯­æ³•æ ‘ï¼ˆé€šå¸¸ç§°ä½œ[åˆ†ææ ‘](https://zh.wikipedia.org/wiki/åˆ†ææ ‘)ï¼‰ã€‚ä¸€èˆ¬çš„ï¼Œåœ¨æºä»£ç çš„ç¿»è¯‘å’Œ[ç¼–è¯‘](https://zh.wikipedia.org/wiki/ç¼–è¯‘)è¿‡ç¨‹ä¸­ï¼Œ[è¯­æ³•åˆ†æå™¨](https://zh.wikipedia.org/wiki/èªæ³•åˆ†æå™¨)åˆ›å»ºå‡ºåˆ†ææ ‘ï¼Œç„¶åä»åˆ†ææ ‘ç”ŸæˆASTã€‚ä¸€æ—¦ASTè¢«åˆ›å»ºå‡ºæ¥ï¼Œåœ¨åç»­çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚[è¯­ä¹‰åˆ†æ](https://zh.wikipedia.org/wiki/è¯­ä¹‰åˆ†æ)é˜¶æ®µï¼Œä¼šæ·»åŠ ä¸€äº›ä¿¡æ¯ã€‚

![ast](./img/babel2.png)

```
//ä¸‹åˆ—è¾—è½¬ç›¸é™¤æ³•ç¼–ç¨‹ç çš„æŠ½è±¡è¯­æ³•æ ‘:
while b â‰  0
	if a > b
		a := a âˆ’ b
	else
		b := b âˆ’ a
return a
```

è¯¦ç»†å‚è€ƒï¼š

[AST Explorer](https://astexplorer.net/)

[esprima](https://esprima.org/demo/parse.html#)

**Babel çš„åŸç†æ˜¯ä»€ä¹ˆ?**

babel çš„è½¬è¯‘è¿‡ç¨‹ä¹Ÿåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œè¿™ä¸‰æ­¥å…·ä½“æ˜¯ï¼š 

* è§£æ Parse: å°†ä»£ç è§£æç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘( å³ AST )ï¼Œå³è¯æ³•åˆ†æä¸è¯­æ³•åˆ†æçš„è¿‡ç¨‹ã€‚
* è½¬æ¢ Transform: å¯¹äº AST è¿›è¡Œå˜æ¢ä¸€ç³»åˆ—çš„æ“ä½œï¼Œbabel æ¥å—å¾—åˆ°ASTï¼Œå¹¶é€šè¿‡ babel-traverse å¯¹å…¶è¿›è¡Œéå†ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­è¿›è¡Œæ·»åŠ ã€æ›´æ–°åŠç§»é™¤ç­‰æ“ä½œã€‚
* ç”Ÿæˆ Generator: å°†å˜æ¢åçš„ AST å†è½¬æ¢ä¸º JS ä»£ç , ä½¿ç”¨åˆ°çš„æ¨¡å—æ˜¯babel-generatorã€‚

![babel](./img/babel1.jpg)

è¯¦ç»†å¯å‚è€ƒï¼š

[åˆå­¦ Babel å·¥ä½œåŸç†](https://zhuanlan.zhihu.com/p/85915575)

### å‚è€ƒé™„å½•

[webpack](https://webpack.docschina.org/)

[ä»Npm Scriptåˆ°Webpackï¼Œ6ç§å¸¸è§çš„å‰ç«¯æ„å»ºå·¥å…·å¯¹æ¯”](https://blog.csdn.net/broadview2006/article/details/79091719)

[ç©è½¬webpack](https://time.geekbang.org/course/intro/100028901?utm_source=pinpaizhuanqu&utm_medium=geektime&utm_campaign=guanwang&utm_term=guanwang&utm_content=0511)

[æŠ½è±¡è¯­æ³•æ ‘](https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E8%AA%9E%E6%B3%95%E6%A8%B9)

[babel æ’ä»¶é€šå…³ç§˜ç±](https://juejin.cn/book/6946117847848321055)

### åè®°

æˆ‘æ˜¯å½¤çˆ±ï¼Œä¸€ä¸ªåœ¨æ²‰æººäºå¯‚å¯ä»£ç æµ·æ´‹é‡Œçš„å‰ç«¯ç¨‹åºå‘˜ğŸ‘¨ğŸ»â€ğŸ’»

æ¬¢è¿å„ä½å¤§ä½¬çš„èµæ•™ğŸ™

æœŸå¾…ä¸åŒæ ·åœ¨åŠªåŠ›æ‘¸ç´¢çš„å°ä¼™ä¼´ä»¬äº¤æµğŸ™Œ






