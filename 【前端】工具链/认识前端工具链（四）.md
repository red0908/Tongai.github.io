## è®¤è¯†å‰ç«¯å·¥å…·é“¾ï¼ˆå››ï¼‰

### å‰ç«¯å·¥å…·é“¾ç»¼è¿°

å·¥å…·é“¾åœ¨å‰ç«¯é¢†åŸŸæ‰®æ¼”ç€å¾ˆé‡è¦çš„è§’è‰²ã€‚å¦‚ä½•**ä¸ºJavascriptç”Ÿäº§ç¯å¢ƒæ„å»ºå»æ„å»ºä¸€å¥—å·¥å…·é“¾ï¼Œæ¥è¦†ç›–å‰ç«¯å„ä¸ªå¼€å‘ç¯èŠ‚**ï¼Œæ˜¯æˆ‘ä»¬éœ€è¦äº†è§£å­¦ä¹ çš„ã€‚è€Œä¸€å¥—é«˜æ•ˆçš„å·¥å…·é“¾ä½“ç³»ï¼Œå¯¹äºæ¯ä¸€ä¸ªå‰ç«¯å›¢é˜Ÿæ¥è¯´éƒ½æœ‰ç€è‡³å…³é‡è¦çš„æ„ä¹‰ï¼Œå®ƒä¸ä»…å¯ä»¥æé«˜å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ï¼Œè¿˜å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„èŒƒå‰ç«¯å¼€å‘çš„å„ä¸ªç¯èŠ‚ï¼Œè¿›è€Œä¸ºå›¢é˜ŸèŠ‚çœä¸€äº›äººå‘˜åä½œå’Œè°ƒæ•´çš„æˆæœ¬ã€‚

ç»¼ä¸Šï¼Œ**å‰ç«¯å·¥å…·é“¾æ—¨åœ¨å‹å¥½å¼€å‘ä½“éªŒï¼Œæå‡å¼€å‘å›¢é˜Ÿå¼€å‘æ•ˆç‡**ã€‚

è€Œè¦æ„å»ºä¸€ä¸ªå·¥å…·é“¾ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆè¦äº†è§£åœ¨å‰ç«¯å¼€å‘é¢†åŸŸæœ‰å“ªå‡ ä¸ªç¯èŠ‚ï¼š

* é¡¹ç›®åˆå§‹åŒ–
* å¼€å‘ã€è°ƒè¯•ã€æ„å»º
* å•å…ƒæµ‹è¯•
* å‘å¸ƒ

æ‰€ä»¥ä¸€ä¸ªå‰ç«¯å·¥å…·é“¾ï¼Œå®ƒå¤§è‡´éƒ½ä¼šåŒ…å«ä¸Šé¢è¿™ä¸€ç³»åˆ—åŠŸèƒ½ã€‚è€Œä¸€ä¸ªå…¸å‹çš„ç¤ºä¾‹å°±ç±»ä¼¼äºä¸‹é¢ï¼š

* Yeoman
* Webpack
* Mocha
* å‘å¸ƒç³»ç»Ÿ

æˆ‘ä»¬å¯ä»¥å°†è¿›è€Œå°†å®ƒæ€»ç»“æˆä¸‹é¢å‡ å—ï¼š

* è„šæ‰‹æ¶
* æ„å»ºâ¼¯å…·
* æµ‹è¯•å·¥å…·
* **å‘å¸ƒç³»ç»Ÿ**

è€Œä¸Šäº†è§„æ¨¡çš„å›¢é˜Ÿä¹Ÿéƒ½ä¼šé’ˆå¯¹ä»¥ä¸Šçš„æµç¨‹ï¼Œåˆ¶å®šä¸€ä¸ªå·¥å…·é“¾ï¼Œå¹¶å°†å®ƒåŒ…è£…æˆä¸€ä¸ªé»‘ç›’å½¢å¼ï¼Œè®©ç¨‹åºå‘˜åœ¨æ¯ä¸ªç¯èŠ‚åªéœ€è¦è¿è¡Œç®€å•å‘½ä»¤è¡Œï¼Œå³å¯è¿›å…¥å¼€å‘æµç¨‹ã€‚

è€Œä»æ•´ä½“ä¸Šäº†è§£å·¥å…·é“¾ç›¸å…³çš„çŸ¥è¯†ä½“ç³»ï¼Œç†Ÿæ‚‰å…¶å¤§è‡´ç»“æ„ä»¥åŠè¿ä½œæ–¹å¼ï¼Œä¹Ÿæ˜¯ååˆ†é‡è¦çš„ã€‚

æ‰€ä»¥ï¼Œä¸‹é¢è¿™é‡Œæ˜¯æœ¬äººå°†å¯¹äºå·¥å…·é“¾ç›¸å…³åŸºç¡€çŸ¥è¯†çš„ä¸€äº›æ•´ç†ã€‚è¿™ä¸€ç¯‡æˆ‘ä»¬é¦–å…ˆæ¥ä»‹ç»çš„æ˜¯ï¼Œå·¥å…·é“¾ä¸­çš„**å‘å¸ƒç³»ç»Ÿ**ã€‚

### å‘å¸ƒç³»ç»Ÿ

æ¯ä¸ªå›¢é˜Ÿä¸ºäº†æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€è¦ï¼Œå…¶å‘å¸ƒç³»ç»Ÿçš„æ¨¡å¼æµç¨‹éƒ½ä¸å¤§ç›¸åŒï¼Œä½†æœ¬è´¨ä¸Šå´æœ‰å…±åŒç‚¹ï¼Œä¸‹é¢æä¾›çš„æ˜¯ä¸€ä¸ªç®€å•æ¨¡å‹çš„ç¤ºä¾‹ã€‚æ„åœ¨è®©å¤§å®¶äº†è§£å®ƒçš„å¤§ä½“æ¶æ„ã€‚

#### ç¯å¢ƒå‡†å¤‡

æˆ‘ä»¬çš„å‘å¸ƒç³»ç»Ÿåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†

* **çº¿ä¸ŠæœåŠ¡ç³»ç»Ÿ**ï¼šç”¨æˆ·åœ¨çº¿ä¸ŠçœŸæ­£ä½¿ç”¨çš„ç³»ç»Ÿ
* **å‘å¸ƒç³»ç»Ÿ**ï¼šç¨‹åºå‘˜å‘çº¿ä¸Šå‘å¸ƒæ‰€éœ€ç³»ç»Ÿçš„ç³»ç»Ÿã€‚è¿™ä¸ªç³»ç»Ÿä¸å¯ä»¥ä¸çº¿ä¸ŠæœåŠ¡ç³»ç»Ÿæ˜¯åŒçº§éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥è·Ÿæˆ‘ä»¬çš„çº¿ä¸ŠæœåŠ¡ç³»ç»Ÿåˆ†å±äºä¸¤ä¸ªç‹¬ç«‹çš„é›†ç¾¤ã€‚è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„æ¨¡å‹ï¼šå³å•æœºï¼ŒåŒçº§éƒ¨ç½²å‘å¸ƒç³»ç»Ÿ
* **å‘å¸ƒå·¥å…·**ï¼šå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸å‘å¸ƒç³»ç»Ÿç›¸è¿æ¥

#### å®ç°ä¸€ä¸ªçº¿ä¸ŠWebæœåŠ¡

#### ç¯å¢ƒå‡†å¤‡

å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçœŸå®çš„æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨è™šæ‹Ÿæœºæ¥ä»£æ›¿ã€‚è¿™é‡Œæ¨èä½¿ç”¨ï¼šOracleçš„VirtualBoxè™šæ‹Ÿæœºï¼Œå®Œå…¨å¼€æºå…è´¹çš„ç‰ˆæœ¬ã€‚

è¿™é‡Œæˆ‘ä»¬åŸºäºçš„æ˜¯Ubuntu Serveæ¥å¼€å‘ã€‚

* å®‰è£…è™šæ‹Ÿæœºæ—¶é•œåƒåœ°å€è¦æ”¹æˆï¼Œé˜¿é‡Œäº‘é•œåƒ

```shell
http://mirrors.aliyun.com/ubuntu
```

* åœ¨è™šæ‹Ÿæœºç¯å¢ƒå®‰è£…

```shell
sudo apt install nodejs
sudo apt install npm
sudo npm install -g n // nodeçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·
sudo n latest
```

**å‚è€ƒé“¾æ¥**ï¼š

- Oracle VM VirtualBox ä¸‹è½½åœ°å€ï¼š[ https://www.virtualbox.org/](https://www.virtualbox.org/)
- Ubuntu 20.04.1 LTS (Focal Fossa) ä¸‹è½½åœ°å€ï¼š
  - å®˜ç½‘ï¼š[ https://releases.ubuntu.com/20.04/](https://releases.ubuntu.com/20.04/)

#### åˆ©ç”¨Expressï¼Œç¼–å†™æœåŠ¡å™¨

**1. æ„å»ºé¡¹ç›®**

é€šè¿‡ `npx` ï¼ˆåŒ…å«åœ¨ Node.js 8.2.0 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼‰å‘½ä»¤æ¥è¿è¡Œ Express åº”ç”¨ç¨‹åºç”Ÿæˆå™¨ã€‚

```shell
npx express-generator
```

é€šè¿‡ç”Ÿæˆå™¨åˆ›å»ºçš„åº”ç”¨ä¸€èˆ¬éƒ½æœ‰å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š

```shell
.
â”œâ”€â”€ app.js
â”œâ”€â”€ bin
â”‚   â””â”€â”€ www
â”œâ”€â”€ package.json
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ images
â”‚   â”œâ”€â”€ javascripts
â”‚   â””â”€â”€ stylesheets
â”‚       â””â”€â”€ style.css
â”œâ”€â”€ routes
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ users.js
â””â”€â”€ views
    â”œâ”€â”€ error.pug
    â”œâ”€â”€ index.pug
    â””â”€â”€ layout.pug

7 directories, 9 files
```

ç„¶åæˆ‘ä»¬è¿™è¾¹å°†routeså’Œviewsä¸­çš„ä¸œè¥¿åˆ æ‰ç„¶åï¼Œåœ¨publicæ–°å»ºä¸€ä¸ªindex.html,å¹¶å°è¯•å°†å®ƒéƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸­ã€‚

**2.éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ˆè™šæ‹Ÿæœºï¼‰**

* åœ¨æœåŠ¡å™¨å¯åŠ¨OpenSSH,æ²¡åŠ å¯ä»¥åœ¨è™šæ‹Ÿæœº```apt install``ä¸€ä¸‹

```shell
service ssh start
```

è¾“å…¥å¯†ç åå°±é»˜è®¤å¯åŠ¨å¥½äº†ï¼Œé»˜è®¤åœ¨22ç«¯å£ç›‘å¬ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨sshè¿›è¡Œè¿œç¨‹ç™»å½•ã€ä¼ æ–‡ä»¶

scp 

* è™šæ‹Ÿæœºé‡Œè®¾å®šç«¯å£è½¬å‘ï¼Œä¸‹é¢ä¾‹å­æ˜¯å®¿ä¸»æœºçš„8022ç«¯å£ä¼šè¢«è½¬å‘åˆ°è™šæ‹Ÿæœºçš„22ç«¯å£

![å›¾ç‰‡](./img/1614823589398.jpg)

* * å‘½ä»¤ï¼š ä»8022ç«¯å£æ‹·è´æœ¬ç›®å½•ä¸‹æ‰€æœ‰èµ„æºåˆ°è™šæ‹Ÿæœºä¸Š

    ```shell
    scp -P 8022 -r ./* tongai@127.0.0.1:/home/tongai/server
    ```

  * ç„¶åè¾“å…¥å¯†ç å°±æ‹·è´æˆåŠŸäº†

* å¯åŠ¨æœåŠ¡

  * åœ¨è™šæ‹ŸæœºæœåŠ¡å™¨æ‰§è¡Œ```npm start`` å¯åŠ¨æœåŠ¡

### å®ç°ä¸€ä¸ªå‘å¸ƒç³»ç»Ÿ

å‘å¸ƒæœåŠ¡æ˜¯ç”±ä¸€ä¸ªå‘å¸ƒçš„æœåŠ¡å™¨ç«¯å’Œä¸€ä¸ªå‘å¸ƒçš„å·¥å…·æ„æˆçš„ã€‚è¿™é‡Œæˆ‘ä»¬é¦–å…ˆä¼šå®ç°æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œç„¶ååœ¨é€æ­¥æ‰©å±•ï¼Œè®©å®ƒæˆä¸ºå·¥ç¨‹ä¸Šä¸€ä¸ªåŸºæœ¬å¯ç”¨çš„å‘å¸ƒç³»ç»Ÿã€‚

#### **1.ç”¨nodeå¯åŠ¨ä¸€ä¸ªç®€å•çš„server**

```js
// publish-server/server.js
let Http = require('http')

Http.createServer(function (request, respond) {
  console.log(request)
  respond.end('Hello world')
}).listen(8082)
```

#### **2.ç¼–å†™ç®€å•çš„å‘é€è¯·æ±‚åŠŸèƒ½**

```js
// publish-tool/publish.js
let Http = require('http')

let request = Http.request({
  hostname: '127.0.0.1',
  port: 8082
},
  response => {
  console.log(response)
})
request.end()

```

#### **3.ç®€å•äº†è§£Node.jsçš„æµ**

##### [Readable Streams](https://nodejs.org/docs/latest-v13.x/api/stream.html#stream_readable_streams)

å¯è¯»æµæ˜¯ä»ä¸­æ¶ˆè´¹æ•°æ®çš„æºçš„æŠ½è±¡ã€‚

```js
const readable = getReadableStreamSomehow();
readable.on('data', (chunk) => {
  console.log(`Received ${chunk.length} bytes of data.`);
});
readable.on('end', () => {
  console.log('There will be no more data.');
});
```

##### [Writable Streams](https://nodejs.org/docs/latest-v13.x/api/stream.html#stream_writable_streams)

å¯å†™æµæ˜¯æ•°æ®å†™å…¥ç›®æ ‡çš„æŠ½è±¡ã€‚

```js
// Write 'hello, ' and then end with 'world!'.
const fs = require('fs');
const file = fs.createWriteStream('example.txt');
file.write('hello, ');
file.end('world!');
// Writing more now is not allowed!
```

å¯¹public-toolå’Œpublic-serverçš„æ”¹é€ ï¼Œè®©å®ƒä»¬å®ç°æ–‡ä»¶æµä¼ è¾“ï¼š

```js
// publish-tool/publish.js
let Http = require('http')
let fs = require('fs')

let request = Http.request({
  hostname: '127.0.0.1',
  port: 8082,
  method: 'POST',
  headers: {
    'Content-type': 'application/octet-stream'
  }
},
  response => {
  console.log(response)
})
let file = fs.createReadStream('./package.json')

file.on('data', chunck => {
  console.log(chunck.toString());
  request.write(chunck)
})
file.on('end', chunck => {
  console.log('read finish');
  request.end(chunck)
})


```

##### 4. æ”¹é€ server

```js
// publish-server/server.js
let Http = require('http')
let fs = require('fs')

Http.createServer(function (request, response) {
  console.log(request.headers)
  let outFile = fs.createWriteStream('../server/public/index.html') // å†™å…¥åˆ°çº¿ä¸ŠWebæœåŠ¡å™¨çš„é™æ€æ–‡ä»¶é‡Œé¢
  request.on('data', chunck => {
    outFile.write(chunck)
    console.log(chunck.toString());
  })
  request.on('end', () => {
    outFile.end()
    response.end('success')
  })
}).listen(8082)
```

* æ”¹é€ å¥½serverä»¥åï¼Œæˆ‘ä»¬å°†å‘å¸ƒæœåŠ¡å™¨```publish-server```ä¹Ÿä¸Šä¼ åˆ°è™šæ‹ŸæœºæœåŠ¡å™¨ä¸Šã€‚

  ```sh
  scp -r -P 8022 ./* tongai@127.0.0.1:/home/tongai/publish-server
  ```

* åœ¨publish-toolä¸­å»ºç«‹å¥½ä¸€ä¸ªé™æ€æ–‡ä»¶```simple.html``` æ›´æ–°``` publish-tool/public.js```ä¸­ä¸Šä¼ çš„æ–‡ä»¶

```js
// publish-tool/publish.js
let file = fs.createReadStream('./simple.html')
```

* æ·»åŠ è™šæ‹Ÿæœºç«¯å£æ˜ å°„ 8882è½¬å‘è‡³8082ï¼Œå³ä¸ºå‘å¸ƒæœåŠ¡å™¨

* æ›´æ–°publish-toolä¸­çš„å†…å®¹ï¼Œæ‰§è¡Œ```node ./publish.js``` ä¸Šä¼ è‡³å‘å¸ƒæœåŠ¡å™¨ï¼Œä»¥æ›´æ–°çº¿ä¸ŠæœåŠ¡å™¨ä¸­æ–‡ä»¶å†…å®¹


###  å®ç°å¤šæ–‡ä»¶ä¸Šä¼ 

è®²åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»å®ç°äº†ä»æ–‡ä»¶åˆ°HTTPå†ä»HTTPåˆ°æ–‡ä»¶çš„è¿™ç§æµå¼ä¼ è¾“ã€‚é€šè¿‡å¯¹æµå¼ä¼ è¾“çš„åŸºç¡€å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»æŠŠæˆ‘ä»¬çš„å·¥å…·é“¾åšæˆäº†å·²ç»å¯ä»¥å•æ–‡ä»¶ä¸Šä¼ ã€‚

è€Œæˆ‘ä»¬é€šå¸¸åœ¨ä¾›åº”é“¾é‡Œé¢å‘å¸ƒçš„ç¯èŠ‚ï¼Œéƒ½ä¸æ˜¯å‘å¸ƒä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬è¦å‘å¸ƒå¤šä¸ªæ–‡ä»¶é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°Nodeé‡Œé¢ä¸€äº›å‹ç¼©ç›¸å…³çš„åŒ…ã€‚

* [readable.pipe](https://nodejs.org/docs/latest-v13.x/api/stream.html#stream_readable_pipe_destination_options)

å¦‚æœä»¬æƒ³æŠŠä¸€ä¸ªæµå¯¼å…¥å¦ä¸€ä¸ªæµé‡Œé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•çš„è°ƒç”¨pipeæ–¹æ³•ã€‚

* [fs.stat](https://nodejs.org/docs/latest-v13.x/api/fs.html#fs_class_fs_stats)

  è¯»å–æ–‡ä»¶å¤§å°

```js
// publish-tool/public.js
let Http = require('http')
let fs = require('fs')
fs.stat('./simple.html', (err, stats) => {
  let request = Http.request({
    hostname: '127.0.0.1',
    port: 8082,
    method: 'POST',
    headers: {
      'Content-Type': 'application/octet-stream',
      // 'Content-Length': stats.size
    }
  },
    response => {
    console.log(response)
  })
  let file = fs.createReadStream('./simple.html')
  file.pipe(request)
  file.on('end', () => request.end())
})

```

**å¤šæ–‡ä»¶ä¸­æ–‡ä»¶å¤¹å‹ç¼©ä¸Šä¼ **

* å‹ç¼©ï¼š[Archiver](https://www.npmjs.com/package/archiver)

```js
// publish-tool/public.js
let Http = require('http')
let fs = require('fs')
const archiver = require('archiver');
let request = Http.request({
  hostname: '127.0.0.1',
  port: 8082,
  method: 'POST',
  headers: {
    'Content-Type': 'application/octet-stream'
  }
},
  response => {
  console.log(response)
})

const archive = archiver('zip', {
  zlib: { level: 9 } // Sets the compression level.
});
archive.directory('./simple/', false)
archive.finalize()
archive.pipe(request)
```

* è§£å‹ï¼š[unzipper](https://www.npmjs.com/package/unzipper)

```js
// publish-server/server.js
let Http = require('http')
let unzipper  = require('unzipper')
Http.createServer(function (request, response) {
  request.pipe(unzipper.Extract({path: '../server/public/'}))
}).listen(8082)
```

 ### ç”¨GitHub oAuthåšä¸€ä¸ªç™»å½•å®ä¾‹

å…·ä½“æ­¥éª¤å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š

* [åˆ›å»ºä¸€ä¸ªgithub APP](https://docs.github.com/en/developers/apps/creating-an-oauth-app)
* [å¼€å‘å®ä¾‹æ–‡æ¡£](https://docs.github.com/en/developers/apps/authorizing-oauth-apps)

ç„¶åæˆ‘ä»¬åœ¨ä»£ç ä¸­éœ€è¦åšä»¥ä¸‹æ­¥éª¤ï¼š

1. åœ¨```publish-tool/publish.js``` ä¸­ï¼Œæ‰“å¼€ https://github.com/login/oath/authorize
2. åœ¨```publish-server/server.js``` ä¸­ï¼Œauthè·¯ç”±ï¼šæ¥å—code,ç”¨code+client_id + client_secretæ¢token
3. åœ¨```publish-tool/publish.js``` ä¸­ï¼Œåˆ›å»ºserver, æ¥å—tokenï¼Œåç‚¹å‡»å‘å¸ƒ
4. åœ¨```publish-server/server.js``` ä¸­ï¼Œpublishè·¯ç”±ï¼šç”¨tokenè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ£€æŸ¥æƒé™ï¼Œæ¥å—å‘å¸ƒ

psï¼šå¤„ç†è·¯ç”±çš„åŒ… **[querystring](https://nodejs.org/api/querystring.html)**

**å‚è€ƒä»£ç **ï¼š

```js
// publish-tool/publish.js
let Http = require('http')
let querystring = require('querystring')
let archiver = require('archiver')
let child_process = require('child_process')

/*******************ç”¨GitHub oAuthåšä¸€ä¸ªç™»å½•å®ä¾‹****************************/
//1. æ‰“å¼€ https://github.com/login/oath/authorize
child_process.exec(`open https://github.com/login/oauth/authorize?client_id=Iv1.7cf0dcf97bc177de`)

//2. åˆ›å»ºserver, æ¥å—tokenï¼Œåç‚¹å‡»å‘å¸ƒ
Http.createServer(function (res, req) {
  let query = querystring.parse(res.url.match(/^\/\?([\s\S]+)$/)[1])
  publish(query.access_token, req)
}).listen(8083)
function publish (access_token, req) {
  let archive = archiver('zip', {
    zlib: { level: 9 } // Sets the compression level.
  });
  archive.directory('./simple/', false)
  archive.finalize()
  console.log(archive)
  let request = Http.request({
    hostname: '127.0.0.1',
    path: '/publish?access_token=' + access_token,
    port: 8082,
    method: 'POST',
    headers: {
      'Content-Type': 'application/octet-stream'
    }
  },
    response => {
      console.log(response)
  })
  archive.pipe(request)
}


```

```js
// publish-server/server.js
let Http = require('http')
let Https = require('https')
let fs = require('fs')
let unzipper  = require('unzipper')
let querystring = require('querystring')

// 2. authè·¯ç”±ï¼šæ¥å—code,ç”¨code+client_id + client_secretæ¢token
function auth (request, response) {
  let query = querystring.parse(request.url.match(/^\/auth\?([\s\S]+)$/)[1])
  getToken(query.code, function (info) {
    console.log(info)
    response.write(`<a
     style="font-size:25px"
     href="http://localhost:8083/?access_token=${info.access_token}">publish</a>`)
    response.end()
  })
}
function getToken (code, callback) {
  let request = Https.request({
    hostname: 'github.com',
    path: `/login/oauth/access_token?code=${code}&client_id=Iv1.7cf0dcf97bc177de&client_secret=70ec8c116fac88816b0e03f0c0f93537be056d91`,
    port: 443,
    method: 'POST'
  }, function (response) {
    let body = ''
    console.log(response)
    response.on('data', chunk => {
      body += chunk.toString()
    })
    response.on('end', () => {
      callback(querystring.parse(body))
    })
  })
  request.end()
}
// 4. publishè·¯ç”±ï¼šç”¨tokenè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ£€æŸ¥æƒé™ï¼Œæ¥å—å‘å¸ƒ
function publish (request, response) {
  let query = querystring.parse(request.url.match(/^\/publish\?([\s\S]+)$/)[1])
  getUser(query.access_token, info => {
    if (info.login === 'red0908') {
      request.pipe(unzipper.Extract({path: '../server/public/'}))
      request.on('end', function () {
        console.log('end')
        response.end('success!')
      })
    }
  })
}
function getUser (access_token, callback) {
  let request = Https.request({
    hostname: 'api.github.com',
    path: '/user',
    port: 443,
    method: 'GET',
    headers: {
      'Authorization': `token ${access_token}`,
      'User-Agent': 'tong-toy-publish'
    }
  }, function (response) {
    let body = ''
    response.on('data', chunk => {
      body += chunk.toString()
    })
    response.on('end', () => {
      callback(JSON.parse(body))
    })
  })
  request.end()
}

Http.createServer(function (request, response) {
  /********ç”¨GitHub oAuthåšä¸€ä¸ªç™»å½•å®ä¾‹***********/ 

  if (request.url.match(/^\/auth\?/))
    return auth(request, response)
  if (request.url.match(/^\/publish\?/))
    return publish(request, response)
  
}).listen(8082)
```

### åè®°

æˆ‘æ˜¯å½¤çˆ±ï¼Œä¸€ä¸ªåœ¨æ²‰æººäºå¯‚å¯ä»£ç æµ·æ´‹é‡Œçš„å‰ç«¯ç¨‹åºå‘˜ğŸ‘¨ğŸ»â€ğŸ’»

æ¬¢è¿å„ä½å¤§ä½¬çš„èµæ•™ğŸ™

æœŸå¾…ä¸åŒæ ·åœ¨åŠªåŠ›æ‘¸ç´¢çš„å°ä¼™ä¼´ä»¬äº¤æµğŸ™Œ









