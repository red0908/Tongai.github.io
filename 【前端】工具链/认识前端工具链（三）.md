## è®¤è¯†å‰ç«¯å·¥å…·é“¾ï¼ˆä¸‰ï¼‰

### å‰ç«¯å·¥å…·é“¾ç»¼è¿°

å·¥å…·é“¾åœ¨å‰ç«¯é¢†åŸŸæ‰®æ¼”ç€å¾ˆé‡è¦çš„è§’è‰²ã€‚å¦‚ä½•**ä¸ºJavascriptç”Ÿäº§ç¯å¢ƒæ„å»ºå»æ„å»ºä¸€å¥—å·¥å…·é“¾ï¼Œæ¥è¦†ç›–å‰ç«¯å„ä¸ªå¼€å‘ç¯èŠ‚**ï¼Œæ˜¯æˆ‘ä»¬éœ€è¦äº†è§£å­¦ä¹ çš„ã€‚è€Œä¸€å¥—é«˜æ•ˆçš„å·¥å…·é“¾ä½“ç³»ï¼Œå¯¹äºæ¯ä¸€ä¸ªå‰ç«¯å›¢é˜Ÿæ¥è¯´éƒ½æœ‰ç€è‡³å…³é‡è¦çš„æ„ä¹‰ï¼Œå®ƒä¸ä»…å¯ä»¥æé«˜å›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ï¼Œè¿˜å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„èŒƒå‰ç«¯å¼€å‘çš„å„ä¸ªç¯èŠ‚ï¼Œè¿›è€Œä¸ºå›¢é˜ŸèŠ‚çœä¸€äº›äººå‘˜åä½œå’Œè°ƒæ•´çš„æˆæœ¬ã€‚

ç»¼ä¸Šï¼Œ**å‰ç«¯å·¥å…·é“¾æ—¨åœ¨å‹å¥½å¼€å‘ä½“éªŒï¼Œæå‡å¼€å‘å›¢é˜Ÿå¼€å‘æ•ˆç‡**ã€‚

è€Œè¦æ„å»ºä¸€ä¸ªå·¥å…·é“¾ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆè¦äº†è§£åœ¨å‰ç«¯å¼€å‘é¢†åŸŸæœ‰å“ªå‡ ä¸ªç¯èŠ‚ï¼š

* é¡¹ç›®åˆå§‹åŒ–
* å¼€å‘ã€è°ƒè¯•ã€æ„å»º
* å•å…ƒæµ‹è¯•
* å‘å¸ƒ

æ‰€ä»¥ä¸€ä¸ªå‰ç«¯å·¥å…·é“¾ï¼Œå®ƒå¤§è‡´éƒ½ä¼šåŒ…å«ä¸Šé¢è¿™ä¸€ç³»åˆ—åŠŸèƒ½ã€‚è€Œä¸€ä¸ªå…¸å‹çš„ç¤ºä¾‹å°±ç±»ä¼¼äºä¸‹é¢ï¼š

* Yeoman
* Webpack
* Mocha
* å‘å¸ƒç³»ç»Ÿ

æˆ‘ä»¬å¯ä»¥å°†è¿›è€Œå°†å®ƒæ€»ç»“æˆä¸‹é¢å‡ å—ï¼š

* è„šæ‰‹æ¶
* æ„å»ºâ¼¯å…·
* **æµ‹è¯•å·¥å…·**
* å‘å¸ƒç³»ç»Ÿ

è€Œä¸Šäº†è§„æ¨¡çš„å›¢é˜Ÿä¹Ÿéƒ½ä¼šé’ˆå¯¹ä»¥ä¸Šçš„æµç¨‹ï¼Œåˆ¶å®šä¸€ä¸ªå·¥å…·é“¾ï¼Œå¹¶å°†å®ƒåŒ…è£…æˆä¸€ä¸ªé»‘ç›’å½¢å¼ï¼Œè®©ç¨‹åºå‘˜åœ¨æ¯ä¸ªç¯èŠ‚åªéœ€è¦è¿è¡Œç®€å•å‘½ä»¤è¡Œï¼Œå³å¯è¿›å…¥å¼€å‘æµç¨‹ã€‚

è€Œä»æ•´ä½“ä¸Šäº†è§£å·¥å…·é“¾ç›¸å…³çš„çŸ¥è¯†ä½“ç³»ï¼Œç†Ÿæ‚‰å…¶å¤§è‡´ç»“æ„ä»¥åŠè¿ä½œæ–¹å¼ï¼Œä¹Ÿæ˜¯ååˆ†é‡è¦çš„ã€‚

æ‰€ä»¥ï¼Œä¸‹é¢è¿™é‡Œæ˜¯æœ¬äººå°†å¯¹äºå·¥å…·é“¾ç›¸å…³åŸºç¡€çŸ¥è¯†çš„ä¸€äº›æ•´ç†ã€‚è¿™ä¸€ç¯‡æˆ‘ä»¬é¦–å…ˆæ¥ä»‹ç»çš„æ˜¯ï¼Œå·¥å…·é“¾ä¸­çš„**æµ‹è¯•å·¥å…·ã€‚**

### å•å…ƒæµ‹è¯•å·¥å…·

æµ‹è¯•å·¥å…·æ˜¯å‰ç«¯å·¥å…·é“¾é‡Œéå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå¯¹äºå¤§éƒ¨åˆ†çš„å¼€æºé¡¹ç›®æ¥è¯´ï¼Œæµ‹è¯•éƒ½æ˜¯ä¸€ä¸ªå¿…éœ€å“ã€‚å¦‚æœæˆ‘ä»¬æŸä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªè¢«é«˜åº¦å¤ç”¨çš„ä¸œè¥¿ï¼Œé‚£æµ‹è¯•çš„æ”¶ç›Šä¹Ÿæ˜¯å¾ˆé«˜çš„ï¼Œæ‰€ä»¥é™¤éæ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬è¿˜éƒ½æ˜¯è¦ä½¿ç”¨å•å…ƒæµ‹è¯• ã€‚

ä¸‹é¢ä»‹ç»ä¸€äº›å½“å‰æœ€æµè¡Œçš„æµ‹è¯•å·¥å…·å’Œä¸€äº›é…å¥—è®¾æ–½ï¼š

è¿™é‡Œæœ‰æµè¡Œçš„ä¸¤ä¸ªåº“ä¸€ä¸ªæ˜¯**Mocha**ï¼Œä¸€ä¸ªæ˜¯**Jest**

### Mocha

Mochaæœ€æ—©æ˜¯ä¸€ä¸ªé’ˆå¯¹Node.jsçš„ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œå®ƒé»˜è®¤åœ¨ä½¿ç”¨Webpoackä¹‹å‰ï¼Œå®ƒéƒ½æ˜¯ä¸æ”¯æŒimport exportçš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¾‹å­é‡Œä½¿ç”¨çš„æ˜¯requireã€‚

##### 1. å®‰è£…

```shell
npm install -g mocha
npm install --save-dev mocha
```

##### 2.åŸºæœ¬ä½¿ç”¨

```js
//test/test.js
var assert = require('assert');
var add = require('../add.js')

describe('add function testing', function () {
  it('1 + 2 shuold be 3', function() {
    assert.equal(add(1, 2), 3);
  });
  it('-5 + 2 shuold be -3', function() {
    assert.equal(add(-5, 2), -3);
  });
})

```

```js
// add.js
function add (a, b) {
  return a + b
}
module.exports = add
```

##### 3.å¼•å…¥babel

è¿™é‡Œæˆ‘ä»¬å¼•å…¥babelæ¥è§£å†³ä¸€ä¸‹add.jså¿…é¡»ç”¨nodeçš„æ–¹å¼module.exportsçš„é—®é¢˜ã€‚è€Œç®€å•çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨webpacké¡¹ç›®ï¼Œç„¶ååœ¨disté‡Œé¢å»åšå•å…ƒæµ‹è¯•ï¼Œä½†ä»ç†è®ºä¸Šè€ƒè™‘ï¼Œæµ‹è¯•è¿™ä¸ªç¯èŠ‚ä¾èµ–äºbuildè¿™ä¸ªç¯èŠ‚ï¼Œæ˜¯ä¸€ä»¶ä¸å¤ªå¥½çš„åšæ³•ã€‚å¦å¤–ï¼Œè¿™å¯¹åé¢åšcode coverageè¯ä»¥ä¸Šé¢è¿™ç§æ–¹å¼çš„è¯ï¼Œä¼šå¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨babelç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªæ–¹æ¡ˆï¼Œå»è§£å†³ã€‚

è¿™ä¸ªæ–¹æ¡ˆæ˜¯babel registerã€‚

###### å®‰è£…

```shell
npm install --save-dev @babel/core @babel/register
npm install --save-dev @babel/preset-env
```

ç„¶åé…ç½®ä¸€ä¸‹babelã€‚

###### å‘½ä»¤

```shell
./node_moudules/.bin/mocha --require @babel/register
```

###### 4. code coverage

code coverageè¡¨ç¤ºæˆ‘ä»¬çš„æµ‹è¯•åˆ°åº•è¦†ç›–äº†æºæ–‡ä»¶çš„å“ªäº›ä»£ç ã€‚è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸ªæ–°çš„å·¥å…·å«åšnycï¼Œå®ƒå¯ä»¥åœ¨ä¸€ä¸ªå¤æ‚çš„æ–‡ä»¶ä¸­ï¼Œæµ‹è¯•å®ƒæœ€ç»ˆæµ‹è¯•çš„è¦†ç›–æ¯”ä¾‹ã€‚

* å®‰è£…

```shell
npm install --save-dev nyc
```

* å‘½ä»¤

```shell
nyc ./node_modules/.bin/mocha
```

è¿™é‡Œæˆ‘ä»¬åŠ å…¥babelä½¿ç”¨ï¼š

* å®‰è£…ä¸¤ä¸ªæ’ä»¶

```shell
npm install --save-dev @istanbuljs/nys-config-babel
npm install --save-dev babel-plugin-istanbul
```

* åœ¨package.jsonä¸­æ·»åŠ ä¸¤ä¸ªscripté¡¹

```json
  "scripts": {
    "test": "mocha --require @babel/register",
    "coverage": "nyc mocha"
  },
```



* æˆ‘ä»¬å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ç”¨```npm run coverage```,å†™ä¸šåŠ¡ä»£ç çš„æ—¶å€™ç”¨çš„æ˜¯```npm run test```



### å¯¹html-parserè¿›è¡Œå•å…ƒæµ‹è¯•

è¿™é‡Œè¦å®Œæˆçš„æ˜¯å¯¹æˆ‘ä¹‹å‰å†™ä¸€ä¸ªhtml-parseræ·»åŠ å•å…ƒæµ‹è¯•ã€‚

è¿™é‡Œå°†ä¹‹å‰çš„ä»£ç æ‹·è´ï¼Œæ–°å»ºä¸€ä¸ªç›®å½•ç„¶åé‡å¤å®Œæˆä¸Šè¿°æ“ä½œã€‚

ç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œå°†å•å…ƒæµ‹è¯•è·‘èµ·æ¥ã€‚

**ç»“æœ**

![å›¾ç‰‡](./img/img01.jpg)

![å›¾ç‰‡](./img/img02.jpg)

ç”±ä¸Šå›¾å¯çŸ¥ï¼Œæµ‹è¯•ç”¨ä¾‹è¦†ç›–ç‡æ˜¯30%å¤šï¼Œä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡ä¿®æ”¹ç”¨ä¾‹å®ç°90%ä»¥ä¸Šè¦†ç›–ã€‚

```js
// parser-test.js
var assert = require('assert');
import {parseHTML} from '../src/parser'

describe('parse html:', function () {
  it('<a></a>', function() {
    let tree = parseHTML('<a></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a href="//time.geekbang.org"></a>', function() {
    let tree = parseHTML('<a href="//time.geekbang.org"></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a href></a>', function() {
    // 127-135
    let tree = parseHTML('<a href></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a href id></a>', function() {
    // 135-143
    let tree = parseHTML('<a href id></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a id=\'a\'></a>', function() {
    // 168-171
    let tree = parseHTML('<a id=\'a\'></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a id=abc></a>', function() {
    // 171-175
    let tree = parseHTML('<a id=abc></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a id="abc" href></a>', function() {
    // 230
    let tree = parseHTML('<a id="abc" href></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a id=abc href></a>', function() {
    // 209-210
    let tree = parseHTML('<a id=abc href></a>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a id=\'a\'/>', function() {
    // 
    let tree = parseHTML('<a id=\'a\'/>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });

  it('<a />', function() {
    // 130
    let tree = parseHTML('<a />')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<A /> upper casse', function() {
    // 100
    let tree = parseHTML('<A />')
    assert.equal(tree.children[0].tagName, 'A');
    assert.equal(tree.children.length, 1);
  });
  it('<a/>', function() {
    // 98
    let tree = parseHTML('<a/>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<a id=a/>', function() {
    let tree = parseHTML('<a id=a/>')
    assert.equal(tree.children[0].tagName, 'a');
    assert.equal(tree.children.length, 1);
  });
  it('<>', function() {
    let tree = parseHTML('<>')
    assert.equal(tree.children[0].type, 'text');
    assert.equal(tree.children[0].content, '<>');
  });
})


```

* ç»“æœ

![å›¾ç‰‡](./img/img03.jpg)

**Vscode:è°ƒè¯•é…ç½®ç¤ºä¾‹**

```json
{
  // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ 
  // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚
  // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "å¯åŠ¨ç¨‹åº",
      "skipFiles": [
        "<node_internals>/**"
      ],
      "sourceMaps": true,
      "runtimeArgs": [
        "--require", "@babel/register"
      ],
      "args": [],
      "program": "${workspaceFolder}/node_modules/.bin/mocha"
    }
  ]
}
```

### å·¥å…·é“¾ä¸generatoré›†æˆ

* generatorä¿®æ”¹ï¼Œpackage.jsonä¸­éœ€è¦å®‰è£…çš„ä¾èµ–ï¼Œå°†å•å…ƒæµ‹è¯•æ¨¡å—ä¹Ÿå¼•å…¥
* generatorå¼•å…¥æ–‡ä»¶.babelrcã€.nycrc
* å¼•å…¥simple-test.js ç®€å•æµ‹è¯•ç”¨ä¾‹å¯¹æ–‡ä»¶
* webpack.configä¸­çš„ç›¸å…³babelé…ç½®çš„å¼•å…¥

```js
// generator/app/index.js
var Generator = require('yeoman-generator');

module.exports = class extends Generator {
    // The name `constructor` is important here
    constructor(args, opts) {
      // Calling the super constructor is important so our generator is correctly set up
      super(args, opts);
    }
    async initPackge () {
      const answers = await this.prompt([
        {
          type: "input",
          name: "name",
          message: "Your project name",
          default: this.appname // Default to current folder name
        },
        {
          type: "input",
          name: "title",
          message: "Your html title",
          default: this.appname // Default to current folder name
        }
      ]);
      const pkgJson = {
        "name": answers.name,
        "version": "1.0.0",
        "description": "",
        "main": "index.js",
        "scripts": {
          "test": "./node_modules/.bin/mocha --require @babel/register",
          "coverage": "nyc ./node_modules/.bin/mocha",
          "build": "./node_modules/.bin/webpack",
        },
        "author": "",
        "license": "ISC",
        "devDependencies": {
        },
        "dependencies": {
        }
      };
      this.fs.extendJSON(this.destinationPath('package.json'), pkgJson);
      this.npmInstall(['vue'], {'save-dev': false});
      this.npmInstall([
        'webpack',
        'babel-loader',
        '@babel/core',
        '@babel/preset-env',
        '@babel/register',
        '@istanbuljs/nyc-config-babel',
        'babel-plugin-istanbul',
        'mocha',
        'nyc',
        'webpack-cli',
        'vue-loader', 
        'vue-template-compiler', 
        'vue-style-loader', 
        'css-loader',
        'copy-webpack-plugin'
      ], {'save-dev': true});
      this.fs.copyTpl(
        this.templatePath('HelloWorld.vue'),
        this.destinationPath('src/HelloWorld.vue'),
        {}
      );
      this.fs.copyTpl(
        this.templatePath('webpack.config.js'),
        this.destinationPath('webpack.config.js'),
        {}
      );
      this.fs.copyTpl(
        this.templatePath('main.js'),
        this.destinationPath('src/main.js'),
        {}
      );
      this.fs.copyTpl(
        this.templatePath('index.html'),
        this.destinationPath('src/index.html'),
        { title: answers.title }
      );
      this.fs.copyTpl(
        this.templatePath('.babelrc'),
        this.destinationPath('.babelrc')
      );
      this.fs.copyTpl(
        this.templatePath('.nycrc'),
        this.destinationPath('.nycrc')
      );
      this.fs.copyTpl(
        this.templatePath('simple-test.js'),
        this.destinationPath('test/simple-test.js')
      );
    }
};
```

### å‚è€ƒé™„å½•

[mocha](https://mochajs.org/)

### åè®°

æˆ‘æ˜¯å½¤çˆ±ï¼Œä¸€ä¸ªåœ¨æ²‰æººäºå¯‚å¯ä»£ç æµ·æ´‹é‡Œçš„å‰ç«¯ç¨‹åºå‘˜ğŸ‘¨ğŸ»â€ğŸ’»

æ¬¢è¿å„ä½å¤§ä½¬çš„èµæ•™ğŸ™

æœŸå¾…ä¸åŒæ ·åœ¨åŠªåŠ›æ‘¸ç´¢çš„å°ä¼™ä¼´ä»¬äº¤æµğŸ™Œ













